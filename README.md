# haizokuAlg
In the university I belong to, the decision of the assignment of the seminar is manual. This program makes it  automatic. This work is demanded by the office of student affairs.


仕様
サンプルファイルを参考に事前に入力データを用意しておく必要があります。
入力データ
  choice.csv : {学籍番号,選択1,選択2,...,選択n}
    表の列名は何でも良いが、順番はこの通りである必要がある。
    学籍番号はプログラム中で主キー判定を行うので、一意かつnon NULLでなければならない
    選択1,...nは学生が選んだ講義のアンケート結果。class.csvのクラスキーと一致していないと誤作動するので注意。
  
  class.csv : {クラスキー,クラス名称}
    表の列名は「クラスキー」と「クラス名称」でなければならない
    クラス名称は講義を行う先生の名前 ex: ○○先生
　　 クラス名称は出力されるファイルの名前に使うだけなので、どんな文字列であっても構わまい。
    クラスキーはクラス名称に対して一意で、非欠損である必要がある。プログラム中で主キー判定を行う

  定員数.txt
    整数値を入力したtxtファイル
    講義の定員数をここに入力する。

出力データ
  割り当て.csv : {id,class,rank}
    idは学生の学籍番号
    classはidに紐づけられた学生が配属するセミナー先に関するクラスキー
    rankはidに紐づけられた学生の事前のアンケートでの配属先順位

  ○○先生.csv : {学籍番号}
    class.csvでのクラス名称の個数だけ作成されるテーブル
    先生ごとの配属される学生の一覧

　例外処理学生につき要確認.csv : {id,class,onoff,rank}
    人気のある講義のみを選択しすぎた上に全ての抽選で弾かれた学生(onoff=-1)か、
　　 アンケートにほとんど記入をしなかったために、講義が割り当てられなかった学生(onoff=0,便宜上classに入力はあ
　　　るが、意味をなしてない)
    のいずれかが存在した場合に例外的に出力されるファイル。
　　 このファイルが出た時は、個別に対応する。


    
    
動作
  不公平感がないアルゴリズムである必要がある
    1.ある学生がアンケート順位3位でセミナーAに所属しているのに、別の学生がアンケート順位2位でセミナーAから排除されることが極力ない
　アンケート結果の後ろの方(5以上)は例外を除き、選ばれないようにする
    2.ただし、1を完全に達成するとこれは実現できない。この場合、1より2の方が優先度が高い。
  環境構築が容易であり、業務引き継ぎに当たって操作が容易である必要がある
    3.極力実行までの動作が少ないほうが良い
    4.一度環境構築を行った後は一切手間が発生しない方が良い
  
  1について
    これは、中のアルゴリズムで実装した。
  2について
    これもアルゴリズムの中で実装した。
  3について
    pythonをし、フォルダ(ディレクトリ)を設定し、そのフォルダに入力データを入れるだけで実行ができる。
  4について
    デフォルトパッケージ以外のパッケージはpandasのみなので、pythonさえ入れておけばほぼエラー無く実行可能
    
    
    
プログラムの構成
	ExaminKeyクラス
		主キー判別を行うクラス。インスタンスに対してキー判別を行うデータ列をSeries型かデータフレームのindexで渡す。

	ChoiceAlgクラス
		動作1を忠実に実装するクラス。mainAlgにて配属を行う。
		#selIndex = len(choice2.columns)のコメントアウトを外し、
		selIndex=5をコメントアウトすると、配属制限を外すことができる。
		ここの値をいじるだけで、配属制限を変更することもできる。

	DoSwapクラス
		ChoiceAlgクラスの動作では配属制限により配属が行われなかった学生の配属を、既配属学生との交換により行う。
		既配属学生と穏便に交換することが不可能な学生はonoff=0として出力する。
		SwapAlgメソッドでは、1位希望で配属された学生と交換を行うか、2位以下の希望で配属された学生と交換を行うかをTrue or Falseで選択する。

	mainクラス(実行部分)
		##以下実行順序##
		1 ChoiceAlgクラスによる仮配属を行う。配属が完了したものにはonoff=1を、未確定のものには0が与えられる
		2 DoSwapクラスにて、onoff=0の学生を配属させるため、2位以下の希望で配属された学生との交換を試みる。穏便に交換可能なら配属先を交換する
		3 DoSwapクラスにて、onoff=0の学生を配属させるため、1位希望で配属された学生との交換を試みる。穏便に交換可能なら配属先を交換する
		4 以上の手順でも配属不可能な学生は、例外的にアンケート結果の5位以降の配属先に配属させる。配属後は例外としてonoff=-1としておく。
		5 4の手順にて、5位以降の配属先が未入力である可能性が考えられる。この場合は依然としてonoff=0のままとなる。
		6 1~5の結果を出力する。出力内容は出力データの通り。

    
    
